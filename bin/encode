#!/usr/bin/env node --experimental-modules

import {encodeImage} from '../lib/encoder.js'
import {fileToPixels} from '../lib/image.js'
import {writeFile} from '../lib/file-write.js'

encodeFileToFile('./example-small.jpg', './example-small.fractal', 4)
  .then(() => console.log('Completed'))
  .catch(console.error)

async function encodeFileToFile(srcPath, dstPath, allowedError) {
  const {r, g, b, width, height} = await fileToPixels(srcPath)
  const encoded = encodeImage(r, g, b, width, height, allowedError)
  await writeFile(encoded, dstPath)
}